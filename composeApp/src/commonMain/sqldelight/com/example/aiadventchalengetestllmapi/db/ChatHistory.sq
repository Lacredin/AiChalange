CREATE TABLE chats (
    id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    title TEXT NOT NULL,
    created_at INTEGER NOT NULL
);

CREATE TABLE chat_messages (
    id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    chat_id INTEGER NOT NULL REFERENCES chats(id) ON DELETE CASCADE,
    api TEXT NOT NULL,
    model TEXT NOT NULL,
    role TEXT NOT NULL,
    message TEXT NOT NULL,
    params_info TEXT NOT NULL,
    created_at INTEGER NOT NULL
);

CREATE TABLE chat_feature_state (
    chat_id INTEGER NOT NULL PRIMARY KEY REFERENCES chats(id) ON DELETE CASCADE,
    is_summarization_enabled INTEGER NOT NULL,
    summarize_after_tokens TEXT NOT NULL,
    is_sliding_window_enabled INTEGER NOT NULL,
    sliding_window_size TEXT NOT NULL,
    is_sticky_facts_enabled INTEGER NOT NULL,
    sticky_facts_window_size TEXT NOT NULL,
    is_branching_enabled INTEGER NOT NULL,
    show_raw_history INTEGER NOT NULL
);

selectChats:
SELECT *
FROM chats
ORDER BY id ASC;

insertChat:
INSERT INTO chats(
    title,
    created_at
)
VALUES (?, ?);

selectLastInsertedChatId:
SELECT last_insert_rowid();

selectMessagesByChat:
SELECT *
FROM chat_messages
WHERE chat_id = ?
ORDER BY id ASC;

selectFeatureStateByChat:
SELECT *
FROM chat_feature_state
WHERE chat_id = ?;

insertMessage:
INSERT INTO chat_messages(
    chat_id,
    api,
    model,
    role,
    message,
    params_info,
    created_at
)
VALUES (?, ?, ?, ?, ?, ?, ?);

upsertFeatureState:
INSERT OR REPLACE INTO chat_feature_state(
    chat_id,
    is_summarization_enabled,
    summarize_after_tokens,
    is_sliding_window_enabled,
    sliding_window_size,
    is_sticky_facts_enabled,
    sticky_facts_window_size,
    is_branching_enabled,
    show_raw_history
)
VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?);

deleteMessagesByChat:
DELETE FROM chat_messages
WHERE chat_id = ?;

deleteFeatureStateByChat:
DELETE FROM chat_feature_state
WHERE chat_id = ?;

deleteChatById:
DELETE FROM chats
WHERE id = ?;

deleteAllMessages:
DELETE FROM chat_messages;

deleteAllFeatureState:
DELETE FROM chat_feature_state;

deleteAllChats:
DELETE FROM chats;
